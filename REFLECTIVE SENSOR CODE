/*
 * ReflectiveSensor.c
 *
 * Created: 15/07/2015 10:09:50 AM
 *  Author: Nigel Prozenko
 */ 


#define F_CPU 14745600UL

#include <avr/io.h>
#include <avr/interrupt.h>
#include <stdio.h>
#include <stdlib.h>
#include <util/delay.h>
static int uart_putchar(char c, FILE *stream);
static int uart_getchar(FILE *stream);
FILE mystdout = FDEV_SETUP_STREAM(uart_putchar, NULL, _FDEV_SETUP_WRITE);
FILE mystdin = FDEV_SETUP_STREAM(NULL, uart_getchar, _FDEV_SETUP_READ);

static int uart_putchar(char c, FILE *stream)
{
	loop_until_bit_is_set(UCSR0A, UDRE0);
	UDR0 = c;
	return 0;
}
static int uart_getchar(FILE *stream)
{
	loop_until_bit_is_set(UCSR0A, RXC0); /* Wait until data exists. */
	return UDR0;
}
void init_uart(void)
{
	UCSR0B = (1<<RXEN0) | (1<<TXEN0);
	UBRR0 = 7;
	stdout = &mystdout;
	stdin = &mystdin;
}

int main(void)
{
   init_uart();
   
   DDRB |= (1<<PB1);
   DDRB &= ~(1<<PB0);
   
   printf("Sensor Parameters Initialized\n");
   
   PORTB |= (1<<PB1);
   
   while(1){
	   
	   if(PINB |= (1<<PB0)){
		   printf("Sensor Reading\n");
   }else{
	   printf("No Response\n");
     }
   }
return 1;   
}
